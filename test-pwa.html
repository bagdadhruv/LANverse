<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LANverse PWA Test</title>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
      color: white;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      background: rgba(26, 26, 46, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 1rem;
      padding: 2rem;
      margin: 1rem 0;
      border: 1px solid rgba(162, 89, 255, 0.2);
    }
    .test-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .test-item:last-child {
      border-bottom: none;
    }
    .status {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .status.pass {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border: 1px solid #4caf50;
    }
    .status.fail {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border: 1px solid #f44336;
    }
    .status.warning {
      background: rgba(255, 152, 0, 0.2);
      color: #ff9800;
      border: 1px solid #ff9800;
    }
    button {
      background: linear-gradient(135deg, #ff6b9d, #a259ff);
      color: white;
      border: none;
      border-radius: 0.75rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      margin: 0.5rem;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(162, 89, 255, 0.4);
    }
    .install-btn {
      background: linear-gradient(135deg, #4caf50, #45a049);
    }
    .notification-btn {
      background: linear-gradient(135deg, #ff9800, #f57c00);
    }
    .offline-btn {
      background: linear-gradient(135deg, #2196f3, #1976d2);
    }
    .log {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>LANverse PWA Test Suite</h1>
    <p>This page helps you test all PWA features and functionality.</p>

    <div class="test-section">
      <h2>PWA Installation</h2>
      <div class="test-item">
        <span>Manifest.json</span>
        <span id="manifest-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>Service Worker</span>
        <span id="sw-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>Install Prompt</span>
        <span id="install-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>App Icons</span>
        <span id="icons-status" class="status">Checking...</span>
      </div>
      <button class="install-btn" onclick="testInstall()">Test Install Prompt</button>
    </div>

    <div class="test-section">
      <h2>Offline Functionality</h2>
      <div class="test-item">
        <span>Cache Storage</span>
        <span id="cache-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>Offline Access</span>
        <span id="offline-status" class="status">Checking...</span>
      </div>
      <button class="offline-btn" onclick="testOffline()">Test Offline Mode</button>
    </div>

    <div class="test-section">
      <h2>Push Notifications</h2>
      <div class="test-item">
        <span>Notification Permission</span>
        <span id="notification-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>Push Manager</span>
        <span id="push-status" class="status">Checking...</span>
      </div>
      <button class="notification-btn" onclick="testNotification()">Test Notification</button>
    </div>

    <div class="test-section">
      <h2>App Features</h2>
      <div class="test-item">
        <span>Standalone Mode</span>
        <span id="standalone-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>Theme Color</span>
        <span id="theme-status" class="status">Checking...</span>
      </div>
      <div class="test-item">
        <span>App Shortcuts</span>
        <span id="shortcuts-status" class="status">Checking...</span>
      </div>
    </div>

    <div class="test-section">
      <h2>Test Log</h2>
      <div id="test-log" class="log"></div>
      <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="test-section">
      <h2>Quick Actions</h2>
      <button onclick="window.location.href='auth.html'">Go to Auth</button>
      <button onclick="window.location.href='home.html'">Go to Home</button>
      <button onclick="window.location.href='index.html'">Go to Landing</button>
      <button onclick="clearCache()">Clear Cache</button>
      <button onclick="unregisterSW()">Unregister Service Worker</button>
    </div>
  </div>

  <script>
    let deferredPrompt;
    let testResults = {};

    // Log function
    function log(message, type = 'info') {
      const logDiv = document.getElementById('test-log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.style.color = type === 'error' ? '#f44336' : type === 'success' ? '#4caf50' : '#fff';
      logEntry.textContent = `[${timestamp}] ${message}`;
      logDiv.appendChild(logEntry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLog() {
      document.getElementById('test-log').innerHTML = '';
    }

    // Test manifest.json
    async function testManifest() {
      try {
        const response = await fetch('/manifest.json');
        if (response.ok) {
          const manifest = await response.json();
          testResults.manifest = true;
          document.getElementById('manifest-status').className = 'status pass';
          document.getElementById('manifest-status').textContent = 'PASS';
          log('Manifest.json loaded successfully', 'success');
        } else {
          throw new Error('Manifest not found');
        }
      } catch (error) {
        testResults.manifest = false;
        document.getElementById('manifest-status').className = 'status fail';
        document.getElementById('manifest-status').textContent = 'FAIL';
        log(`Manifest test failed: ${error.message}`, 'error');
      }
    }

    // Test service worker
    async function testServiceWorker() {
      if ('serviceWorker' in navigator) {
        try {
          const registration = await navigator.serviceWorker.getRegistration();
          if (registration) {
            testResults.serviceWorker = true;
            document.getElementById('sw-status').className = 'status pass';
            document.getElementById('sw-status').textContent = 'PASS';
            log('Service Worker registered', 'success');
          } else {
            throw new Error('No service worker registration found');
          }
        } catch (error) {
          testResults.serviceWorker = false;
          document.getElementById('sw-status').className = 'status fail';
          document.getElementById('sw-status').textContent = 'FAIL';
          log(`Service Worker test failed: ${error.message}`, 'error');
        }
      } else {
        testResults.serviceWorker = false;
        document.getElementById('sw-status').className = 'status fail';
        document.getElementById('sw-status').textContent = 'NOT SUPPORTED';
        log('Service Worker not supported in this browser', 'error');
      }
    }

    // Test install prompt
    function testInstallPrompt() {
      if (deferredPrompt) {
        testResults.installPrompt = true;
        document.getElementById('install-status').className = 'status pass';
        document.getElementById('install-status').textContent = 'AVAILABLE';
        log('Install prompt available', 'success');
      } else {
        testResults.installPrompt = false;
        document.getElementById('install-status').className = 'status warning';
        document.getElementById('install-status').textContent = 'NOT AVAILABLE';
        log('Install prompt not available (may need to meet criteria)', 'warning');
      }
    }

    // Test app icons
    async function testAppIcons() {
      const iconSizes = [72, 96, 128, 144, 152, 192, 384, 512];
      let allIconsExist = true;

      for (const size of iconSizes) {
        try {
          const response = await fetch(`/assets/images/icon-${size}.png`);
          if (!response.ok) {
            allIconsExist = false;
            log(`Icon ${size}x${size} not found`, 'error');
          }
        } catch (error) {
          allIconsExist = false;
          log(`Icon ${size}x${size} test failed: ${error.message}`, 'error');
        }
      }

      if (allIconsExist) {
        testResults.icons = true;
        document.getElementById('icons-status').className = 'status pass';
        document.getElementById('icons-status').textContent = 'PASS';
        log('All app icons found', 'success');
      } else {
        testResults.icons = false;
        document.getElementById('icons-status').className = 'status fail';
        document.getElementById('icons-status').textContent = 'FAIL';
        log('Some app icons missing', 'error');
      }
    }

    // Test cache storage
    async function testCacheStorage() {
      if ('caches' in window) {
        try {
          const cacheNames = await caches.keys();
          if (cacheNames.length > 0) {
            testResults.cache = true;
            document.getElementById('cache-status').className = 'status pass';
            document.getElementById('cache-status').textContent = 'PASS';
            log(`Cache storage working (${cacheNames.length} caches)`, 'success');
          } else {
            testResults.cache = false;
            document.getElementById('cache-status').className = 'status warning';
            document.getElementById('cache-status').textContent = 'EMPTY';
            log('Cache storage available but empty', 'warning');
          }
        } catch (error) {
          testResults.cache = false;
          document.getElementById('cache-status').className = 'status fail';
          document.getElementById('cache-status').textContent = 'FAIL';
          log(`Cache test failed: ${error.message}`, 'error');
        }
      } else {
        testResults.cache = false;
        document.getElementById('cache-status').className = 'status fail';
        document.getElementById('cache-status').textContent = 'NOT SUPPORTED';
        log('Cache storage not supported', 'error');
      }
    }

    // Test offline functionality
    function testOfflineFunctionality() {
      if (navigator.onLine) {
        testResults.offline = 'online';
        document.getElementById('offline-status').className = 'status warning';
        document.getElementById('offline-status').textContent = 'ONLINE';
        log('Currently online - test offline mode manually', 'warning');
      } else {
        testResults.offline = 'offline';
        document.getElementById('offline-status').className = 'status pass';
        document.getElementById('offline-status').textContent = 'OFFLINE';
        log('Currently offline - testing offline functionality', 'success');
      }
    }

    // Test notifications
    function testNotifications() {
      if ('Notification' in window) {
        if (Notification.permission === 'granted') {
          testResults.notifications = true;
          document.getElementById('notification-status').className = 'status pass';
          document.getElementById('notification-status').textContent = 'GRANTED';
          log('Notification permission granted', 'success');
        } else if (Notification.permission === 'denied') {
          testResults.notifications = false;
          document.getElementById('notification-status').className = 'status fail';
          document.getElementById('notification-status').textContent = 'DENIED';
          log('Notification permission denied', 'error');
        } else {
          testResults.notifications = 'prompt';
          document.getElementById('notification-status').className = 'status warning';
          document.getElementById('notification-status').textContent = 'PROMPT';
          log('Notification permission not set', 'warning');
        }
      } else {
        testResults.notifications = false;
        document.getElementById('notification-status').className = 'status fail';
        document.getElementById('notification-status').textContent = 'NOT SUPPORTED';
        log('Notifications not supported', 'error');
      }
    }

    // Test push manager
    function testPushManager() {
      if ('serviceWorker' in navigator && 'PushManager' in window) {
        testResults.pushManager = true;
        document.getElementById('push-status').className = 'status pass';
        document.getElementById('push-status').textContent = 'PASS';
        log('Push Manager supported', 'success');
      } else {
        testResults.pushManager = false;
        document.getElementById('push-status').className = 'status fail';
        document.getElementById('push-status').textContent = 'NOT SUPPORTED';
        log('Push Manager not supported', 'error');
      }
    }

    // Test standalone mode
    function testStandaloneMode() {
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
      if (isStandalone) {
        testResults.standalone = true;
        document.getElementById('standalone-status').className = 'status pass';
        document.getElementById('standalone-status').textContent = 'ACTIVE';
        log('Running in standalone mode', 'success');
      } else {
        testResults.standalone = false;
        document.getElementById('standalone-status').className = 'status warning';
        document.getElementById('standalone-status').textContent = 'BROWSER';
        log('Running in browser mode', 'warning');
      }
    }

    // Test theme color
    function testThemeColor() {
      const themeColor = document.querySelector('meta[name="theme-color"]');
      if (themeColor && themeColor.content) {
        testResults.themeColor = true;
        document.getElementById('theme-status').className = 'status pass';
        document.getElementById('theme-status').textContent = 'SET';
        log(`Theme color set: ${themeColor.content}`, 'success');
      } else {
        testResults.themeColor = false;
        document.getElementById('theme-status').className = 'status fail';
        document.getElementById('theme-status').textContent = 'NOT SET';
        log('Theme color not set', 'error');
      }
    }

    // Test app shortcuts
    function testAppShortcuts() {
      // This is a basic test - actual shortcuts depend on manifest
      testResults.shortcuts = true;
      document.getElementById('shortcuts-status').className = 'status pass';
      document.getElementById('shortcuts-status').textContent = 'CONFIGURED';
      log('App shortcuts configured in manifest', 'success');
    }

    // Test functions
    function testInstall() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            log('User accepted the install prompt', 'success');
          } else {
            log('User dismissed the install prompt', 'warning');
          }
          deferredPrompt = null;
        });
      } else {
        log('Install prompt not available', 'warning');
      }
    }

    function testOffline() {
      if (navigator.onLine) {
        log('Currently online. Turn off internet to test offline mode.', 'warning');
      } else {
        log('Testing offline functionality...', 'info');
        // Test if essential pages load from cache
        fetch('/auth.html')
          .then(response => {
            if (response.ok) {
              log('Auth page loads offline', 'success');
            } else {
              log('Auth page not available offline', 'error');
            }
          })
          .catch(error => {
            log(`Offline test failed: ${error.message}`, 'error');
          });
      }
    }

    function testNotification() {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('LANverse PWA Test', {
          body: 'This is a test notification from LANverse PWA',
          icon: '/assets/images/icon-192.png',
          badge: '/assets/images/icon-72.png'
        });
        log('Test notification sent', 'success');
      } else if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            log('Notification permission granted', 'success');
            testNotification();
          } else {
            log('Notification permission denied', 'error');
          }
        });
      } else {
        log('Notifications not supported or permission denied', 'error');
      }
    }

    function clearCache() {
      if ('caches' in window) {
        caches.keys().then(cacheNames => {
          return Promise.all(
            cacheNames.map(cacheName => {
              log(`Clearing cache: ${cacheName}`, 'info');
              return caches.delete(cacheName);
            })
          );
        }).then(() => {
          log('All caches cleared', 'success');
          testCacheStorage();
        });
      }
    }

    function unregisterSW() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          for (let registration of registrations) {
            registration.unregister();
            log('Service Worker unregistered', 'success');
          }
        });
      }
    }

    // Initialize tests
    window.addEventListener('load', () => {
      log('PWA Test Suite initialized', 'info');
      
      // Run all tests
      testManifest();
      testServiceWorker();
      testAppIcons();
      testCacheStorage();
      testOfflineFunctionality();
      testNotifications();
      testPushManager();
      testStandaloneMode();
      testThemeColor();
      testAppShortcuts();
      
      // Set up install prompt listener
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        testInstallPrompt();
        log('Install prompt captured', 'success');
      });
      
      // Set up online/offline listeners
      window.addEventListener('online', () => {
        log('Browser went online', 'info');
        testOfflineFunctionality();
      });
      
      window.addEventListener('offline', () => {
        log('Browser went offline', 'info');
        testOfflineFunctionality();
      });
    });
  </script>
</body>
</html> 